<!DOCTYPE html>
<html>
<head>
	<title>Kevin Kim's: 33Across Project</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="./css/styles.css">
</head>

<body>
	
	<h2 class="title">Kevin Kim's: Tic-Tac-Toe App</h2>

	<div id="wrapper">

		<div class="board-controls">
			<p>
				<strong>Turn:</strong>
				<span class="current-player"></span>
			</p>
			<p>
				<strong>Winner:</strong>
				<span class="current-player"></span>
			</p>			
			<div class="control-buttons">
				<button class="btn-blue reset-btn">Reset game</button>
			</div> <!-- /.control-button -->
		</div> <!-- /.board-controls -->

		<div class="board-table">
			<table class="game-board">
				<tr>
					<td class="cell">
						<div class="box" box-index="0"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="1"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="2"></div>
					</td> <!-- /.cell -->
				</tr>
				<tr>
					<td class="cell">
						<div class="box" box-index="3"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="4"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="5"></div>
					</td> <!-- /.cell -->
				</tr>
				<tr>
					<td class="cell">
						<div class="box" box-index="6"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="7"></div>
					</td> <!-- /.cell -->
					<td class="cell">
						<div class="box" box-index="8"></div>
					</td> <!-- /.cell -->
				</tr>
			</table> <!-- /.game-board -->

			<div class="board-modal">
				<div class="modal-body">
					<h1>GAME OVER</h1>
					<button class="btn-blue reset-btn">New Game?</button>
				</div>
				
			</div> <!-- /.board-modal -->			
		</div> <!-- /.board-table -->

	</div><!--  ./#wrapper -->
	
	
</body>

<script type="text/javascript">

	//Utils module with helper functions
	const Utils = (function() {

		function isGameCompleted(boxes) {
		  return boxes.every((box) => {
		  	return box !== null;
		  });			
		}

		function addClickHandlers(elements, handler) {
			for (let i=0; i<elements.length; i++) {
				elements[i].addEventListener('click', handler);
			}
		}

		function updateElementsTextValue(elements, textValue) {
			for (let i=0; i<elements.length; i++) {
				elements[i].innerText = textValue;
			}			
		}

		return {
			isGameCompleted: isGameCompleted,
			addClickHandlers: addClickHandlers,
			updateElementsTextValue: updateElementsTextValue,
		};

	}());


	const Game = (function() {
		//cached box elements
		let boxEls = document.querySelectorAll('.box');
		let resetBtnEls = document.querySelectorAll('.reset-btn');
		let currentPlayerEl = document.querySelector('.current-player');
		let boardModalEl = document.querySelector('.board-modal');


		let state = {
			boxes: Array(9).fill(null),
			currentPlayer: 'X',
		};

		function handleBoxClick(evt) {
			evt.stopPropagation();
			let selBoxIndex = Number(evt.target.getAttribute('box-index'));
			let currentPlayer = state.currentPlayer;

			//only allow click updates if state of selected box is null (empty)
			if (state.boxes[selBoxIndex] === null) {
				state.boxes[selBoxIndex] = currentPlayer;
				this.innerText = currentPlayer;
				//toggle to next player after state is updated
				updateToNextPlayer();
			}

			//check to see if game is finished (no more empty boxes)
			//if game is completed, add classname 'active' to boardModalEl
			if (Utils.isGameCompleted(state.boxes)) {
				alert('game is completed');
				boardModalEl.classList.add('active');
			}

		}

		function updateToNextPlayer() {
			let currentPlayer = state.currentPlayer;
			if (currentPlayer === 'X') {
				state.currentPlayer = 'O';
			} else {
				state.currentPlayer = 'X';
			}

			//update value of current player element value with new current player
			currentPlayerEl.innerText = state.currentPlayer;
		}

		function resetGameHandler(evt) {
			evt.stopPropagation();
			//update state.box values with null values and currentPlayer back to 'X'
			state.boxes = Array(9).fill(null);
			state.currentPlayer = 'X';
			//update text for all box elements back to empty string
			Utils.updateElementsTextValue(boxEls, '');
			Utils.updateElementsTextValue([currentPlayerEl], state.currentPlayer);

			//if board-modal is active, remove 'active' class
			if (boardModalEl.classList.contains('active')) {
				boardModalEl.classList.remove('active')
			}
			console.log('Game has been reset!');

		}

		function init() {
			currentPlayerEl.innerText = state.currentPlayer;
			Utils.addClickHandlers(boxEls, handleBoxClick);
			Utils.addClickHandlers(resetBtnEls, resetGameHandler);
		}

		return {
			init: init
		};

	}());


	Game.init();


</script>

</html>